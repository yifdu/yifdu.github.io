<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<meta name="theme-color" content="#222">
<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！请问博主爸爸');
                history.back();
            }
        }
    })();
</script>


  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "258f1ebb"
    });
  daovoice('update');
  </script>









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="数据挖掘,Kaggle比赛,">










<meta name="description" content="数据挖掘重要库——pandaspandas查询表 1234import pandas as pd   //数据分析，代码基于numpyimport numpy as np    //处理数据，代码基于ndarrayimport matplotlib.pyplot as plt      //画图 pandas主要用于数据分析，numpy库主要用于处理数据，matplotlib库主要用于画图 1tr">
<meta name="keywords" content="数据挖掘,Kaggle比赛">
<meta property="og:type" content="article">
<meta property="og:title" content="数据挖掘比赛入坑（三）">
<meta property="og:url" content="http://yifdu.github.io/2019/05/25/数据挖掘比赛入坑（三）/index.html">
<meta property="og:site_name" content="深度菜鸟">
<meta property="og:description" content="数据挖掘重要库——pandaspandas查询表 1234import pandas as pd   //数据分析，代码基于numpyimport numpy as np    //处理数据，代码基于ndarrayimport matplotlib.pyplot as plt      //画图 pandas主要用于数据分析，numpy库主要用于处理数据，matplotlib库主要用于画图 1tr">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1558802715289&di=e2dcd09b141466b41ed7042ad5a259a7&imgtype=0&src=http%3A%2F%2Fpuui.qpic.cn%2Fqqvideo_ori%2F0%2Ft0787mycz6e_496_280%2F0">
<meta property="og:updated_time" content="2019-05-26T16:35:00.467Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据挖掘比赛入坑（三）">
<meta name="twitter:description" content="数据挖掘重要库——pandaspandas查询表 1234import pandas as pd   //数据分析，代码基于numpyimport numpy as np    //处理数据，代码基于ndarrayimport matplotlib.pyplot as plt      //画图 pandas主要用于数据分析，numpy库主要用于处理数据，matplotlib库主要用于画图 1tr">
<meta name="twitter:image" content="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1558802715289&di=e2dcd09b141466b41ed7042ad5a259a7&imgtype=0&src=http%3A%2F%2Fpuui.qpic.cn%2Fqqvideo_ori%2F0%2Ft0787mycz6e_496_280%2F0">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yifdu.github.io/2019/05/25/数据挖掘比赛入坑（三）/">





  <title>数据挖掘比赛入坑（三） | 深度菜鸟</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">深度菜鸟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-resume">
          <a href="/resume/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            简历
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yifdu.github.io/2019/05/25/数据挖掘比赛入坑（三）/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yif Du">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xuanyi.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="深度菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">数据挖掘比赛入坑（三）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-25T21:55:04+08:00">
                2019-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/数据挖掘比赛/" itemprop="url" rel="index">
                    <span itemprop="name">数据挖掘比赛</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 阅读数
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  10.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  48 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope="" itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox" href="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1558802715289&di=e2dcd09b141466b41ed7042ad5a259a7&imgtype=0&src=http%3A%2F%2Fpuui.qpic.cn%2Fqqvideo_ori%2F0%2Ft0787mycz6e_496_280%2F0" rel="gallery_cjwuru35h00o5ukwacjwxcgkn" itemscope="" itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1558802715289&di=e2dcd09b141466b41ed7042ad5a259a7&imgtype=0&src=http%3A%2F%2Fpuui.qpic.cn%2Fqqvideo_ori%2F0%2Ft0787mycz6e_496_280%2F0" itemprop="contentUrl">
              </a>
            
          

          
          </div>
        </div>
      

      
        <h1 id="数据挖掘重要库——pandas"><a href="#数据挖掘重要库——pandas" class="headerlink" title="数据挖掘重要库——pandas"></a>数据挖掘重要库——pandas</h1><p><a href="https://www.cnblogs.com/P--K/p/8284167.html" target="_blank" rel="noopener">pandas查询表</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd   //数据分析，代码基于numpy</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np    //处理数据，代码基于ndarray</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt      //画图</span><br></pre></td></tr></table></figure>
<p>pandas主要用于数据分析，numpy库主要用于处理数据，matplotlib库主要用于画图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df = pd.read_json(<span class="string">"train.json"</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>.index：获取键列表</li>
<li>.values：获取值列表(转换为ndarray型)</li>
<li>直接输入dataframe名称，可显示整个数据集</li>
<li>.head(num)，tail(num):查看头数据，不加参数默认为5,加.T为转置</li>
<li>.columns:查看存在的所有列</li>
<li>.describe():输出所有列的各参数:</li>
</ol>
<ul>
<li>count—计数</li>
<li>mean—平均值</li>
<li>std—标准差</li>
<li>min—最小值</li>
<li>max—最大值</li>
<li>25%—第一个四分位数</li>
<li>50%—中位数</li>
<li>75%—第三个四分位数</li>
</ul>
<ol>
<li>.info()</li>
<li>.isnull().sum():可以查看数据集中是否含有缺失值<br>注：当然这只是一个简单的检测方式，由于数据类型的原因，部分以数组形式出的数据是无法通过这种方法检测出来，需要在后续做的时候进一步分析 。</li>
<li>.sort_index():按行索引进行排序,可以看到以行的id从小到大排序</li>
<li>.sort_index(ascending=False)可以用ascending=True或False来决定是正序还是倒叙</li>
<li>.sort_index(axis=1):按列索引进行排序</li>
<li>.sort_values(by=’’),sort_values(by=[‘’,’’]:按照值的一个或多个进行排序</li>
<li>train_df[‘name’]或train_df.name:列出某一特定列的值</li>
<li>加两个中括号后：train_df[[‘name’]]选出某两列</li>
<li>train_df[10:20]:列出范围内局部的数据</li>
<li>train_df.loc[ : ,[‘name1’,’name2’]]：局部选择</li>
<li><p>.at：选择具体某个元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.at[dates[<span class="number">0</span>],<span class="string">'A'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>.iloc[num]:从0开始,第num行</p>
</li>
<li><p>.iloc[num1:num2,num3:num4]:第num1+1行到num2行,第num3+1列到第num4列<br>.iloc剩下的几个用法对比网上例子：<br><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic1.png" alt="pic1"></p>
</li>
<li><p>train_df2=train_df1.copy()：对train_df1的复制</p>
</li>
<li><p>isin:<br>参考网上例子如下：<br><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic2.png" alt="pic2"></p>
</li>
<li><p>apply:对行或列进行操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">'num_photos'</span>]=train_df[<span class="string">'photos'</span>].apply(len)</span><br><span class="line">train_df[<span class="string">'num_features'</span>]=train_df[<span class="string">'features'</span>].apply(len)</span><br><span class="line">train_df[<span class="string">'num_description_words'</span>] = train_df[<span class="string">'description'</span>].apply(<span class="keyword">lambda</span> x : len(x.split(<span class="string">' '</span>)))</span><br><span class="line">train_df[<span class="string">'num_description_len'</span>]=train_df[<span class="string">'description'</span>].apply(len)</span><br></pre></td></tr></table></figure>
</li>
<li><p>len函数返回列表元素个数，或者字符串长度<br>lambda表达式，通常是在需要一个函数，但是又不想费神去命名一个函数的场合下使用，也就是指匿名函数。<br><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic3.png" alt="pic3"></p>
</li>
<li><p>映射：<br>Interest_level是每条记录对应的分类结果，分别为：low，medium，high，以string形式给出，由于在模型训练中只接受数值型的数据，因此我们可以做一个映射如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">label_num_map=&#123;<span class="string">'high'</span>:<span class="number">0</span>,<span class="string">'medium'</span>:<span class="number">1</span>,<span class="string">'low'</span>:<span class="number">2</span>&#125;</span><br><span class="line">train_df[<span class="string">'label'</span>]=train_df[<span class="string">'interest_level'</span>].apply(<span class="keyword">lambda</span> x:label_num_map[x])</span><br><span class="line">train_df[[<span class="string">'label'</span>]].head()</span><br></pre></td></tr></table></figure>
</li>
<li><p>One-hot编码，方便后续的特征提取<br>使用get_dummies进行one-hot编码<br>concat函数是在pandas底下的方法，可以将数据根据不同的轴作简单的融合,<br>参数如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.concat(objs, axis=<span class="number">0</span>, join=<span class="string">'outer'</span>, join_axes=<span class="keyword">None</span>, ignore_index=<span class="keyword">False</span>,keys=<span class="keyword">None</span>, levels=<span class="keyword">None</span>, names=<span class="keyword">None</span>, verify_integrity=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>参数说明:<br>objs: series，dataframe或者是panel构成的序列lsit<br>axis： 需要合并链接的轴，0是行，1是列<br>join：连接的方式 inner，或者outer<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interest_level = pd.get_dummies(train_df[<span class="string">'interest_level'</span>])</span><br><span class="line">train_df=pd.concat([train_df,interest_level],axis=<span class="number">1</span>)</span><br><span class="line">train_df[[<span class="string">'interest_level'</span>,<span class="string">'high'</span>,<span class="string">'low'</span>,<span class="string">'medium'</span>]].head()</span><br></pre></td></tr></table></figure></p>
<ol>
<li>删除列：train_df.drop(“medium”,axis=1,inplace=True),asis=1表示删除的是一列</li>
<li>删除行：train_df.drop(10,axis=0,inplace=True)，10表示的是将删除的id，axis=0表示删除的是一行</li>
<li>增加的关键字是append，可以用iloc定位然后增加。</li>
<li><p>对于时间类型的数据，我们可以获取它对应的年月日 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_df[<span class="string">'created_year'</span>] = pd.to_datetime(train_df[<span class="string">'created'</span>]).dt.year</span><br><span class="line">train_df[<span class="string">'created_month'</span>] = pd.to_datetime(train_df[<span class="string">'created'</span>]).dt.month</span><br><span class="line">train_df[<span class="string">'created_day'</span>] = pd.to_datetime(train_df[<span class="string">'created'</span>]).dt.day</span><br><span class="line">train_df[[<span class="string">'created'</span>,<span class="string">'created_year'</span>,<span class="string">'created_month'</span>,<span class="string">'created_day'</span>]].head()</span><br></pre></td></tr></table></figure>
</li>
<li><p>对不同卧室数目的房屋的感兴趣程度数目<br>和对不同卧室数目的房屋感兴趣程度（高/中/低）占对该类型房屋总数目的比：<br>groupby：对数据进行分组, 分组后使用sum之类的方法可以计算分组后的结果</p>
</li>
<li>add_suffix:将列标签前面加上后缀suffix</li>
<li>reset_index():将索引作为df中的一列值<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bedroom_features = train_df.groupby([<span class="string">'bedrooms'</span>])[<span class="string">'high'</span>,<span class="string">'low'</span>,<span class="string">'medium'</span>].sum().add_suffix(<span class="string">'_count'</span>).reset_index()</span><br><span class="line">bedroom_features[<span class="string">'all_count'</span>] = train_df.groupby([<span class="string">'bedrooms'</span>])[<span class="string">'price'</span>].count()</span><br><span class="line">bedroom_features[<span class="string">'high_ratio'</span>] = bedroom_features[<span class="string">'high_count'</span>]/bedroom_features[<span class="string">'all_count'</span>]</span><br><span class="line">bedroom_features[<span class="string">'medium_ratio'</span>]=bedroom_features[<span class="string">'medium_count'</span>]/bedroom_features[<span class="string">'all_count'</span>]</span><br><span class="line">bedroom_features[<span class="string">'low_ratio'</span>]=bedroom_features[<span class="string">'low_count'</span>]/bedroom_features[<span class="string">'all_count'</span>]</span><br><span class="line">bedroom_features.head()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>numpy库中的arange关键字：</p>
<p>第一个参数为起始参数，第二个为结束参数，第三个为步长。</p>
<h2 id="groupby-聚合-分组级运算"><a href="#groupby-聚合-分组级运算" class="headerlink" title="groupby,聚合,分组级运算"></a>groupby,聚合,分组级运算</h2><p>groupby<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">'key1'</span>:list(<span class="string">'aabba'</span>),</span><br><span class="line">                  <span class="string">'key2'</span>: [<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>],</span><br><span class="line">                  <span class="string">'data1'</span>: np.random.randn(<span class="number">5</span>),</span><br><span class="line">                  <span class="string">'data2'</span>: np.random.randn(<span class="number">5</span>)&#125;)</span><br><span class="line">df</span><br><span class="line">grouped=df[<span class="string">'data1'</span>].groupby(df[<span class="string">'key1'</span>])</span><br><span class="line">grouped.mean()</span><br></pre></td></tr></table></figure></p>
<p><strong>以上的分组键均为Series，实际上分组键可以是任何长度适当的数组</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">states=np.array([<span class="string">'Ohio'</span>,<span class="string">'California'</span>,<span class="string">'California'</span>,<span class="string">'Ohio'</span>,<span class="string">'Ohio'</span>])</span><br><span class="line">years=np.array([<span class="number">2005</span>,<span class="number">2005</span>,<span class="number">2006</span>,<span class="number">2005</span>,<span class="number">2006</span>])</span><br><span class="line">df[<span class="string">'data1'</span>].groupby([states,years]).mean()</span><br></pre></td></tr></table></figure></p>
<p>对分组进行迭代<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name, group <span class="keyword">in</span> df.groupby(<span class="string">'key1'</span>):</span><br><span class="line">        <span class="keyword">print</span> (name)</span><br><span class="line">        <span class="keyword">print</span> (group)</span><br></pre></td></tr></table></figure></p>
<p>可以看出name就是groupby中的key1的值，group就是要输出的内容。<br>同理：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (k1,k2),group <span class="keyword">in</span> df.groupby([<span class="string">'key1'</span>,<span class="string">'key2'</span>]):</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'===k1,k2:'</span>)</span><br><span class="line">    <span class="keyword">print</span> (k1,k2)</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'===k3:'</span>)</span><br><span class="line">    <span class="keyword">print</span> (group)</span><br></pre></td></tr></table></figure></p>
<p>对group by后的内容进行操作，如转换成字典</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">piece=dict(list(df.groupby(<span class="string">'key1'</span>)))</span><br><span class="line">piece</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">'a'</span>:       data1     data2 key1 key2</span><br><span class="line"> <span class="number">0</span> <span class="number">-0.233405</span> <span class="number">-0.756316</span>    a  one</span><br><span class="line"> <span class="number">1</span> <span class="number">-0.232103</span> <span class="number">-0.095894</span>    a  two</span><br><span class="line"> <span class="number">4</span>  <span class="number">1.056224</span>  <span class="number">0.736629</span>    a  one, <span class="string">'b'</span>:       data1     data2 key1 key2</span><br><span class="line"> <span class="number">2</span>  <span class="number">0.200875</span>  <span class="number">0.598282</span>    b  one</span><br><span class="line"> <span class="number">3</span> <span class="number">-1.437782</span>  <span class="number">0.107547</span>    b  two&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">piece[<span class="string">'a'</span>]</span><br></pre></td></tr></table></figure>
<p>groupby默认是在axis=0上进行分组的，通过设置也可以在其他任何轴上进行分组.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">grouped=df.groupby(df.dtypes, axis=<span class="number">1</span>)</span><br><span class="line">dict(list(grouped))</span><br><span class="line"></span><br><span class="line">&#123;dtype(<span class="string">'float64'</span>):       data1     data2</span><br><span class="line"> <span class="number">0</span> <span class="number">-0.233405</span> <span class="number">-0.756316</span></span><br><span class="line"> <span class="number">1</span> <span class="number">-0.232103</span> <span class="number">-0.095894</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0.200875</span>  <span class="number">0.598282</span></span><br><span class="line"> <span class="number">3</span> <span class="number">-1.437782</span>  <span class="number">0.107547</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">1.056224</span>  <span class="number">0.736629</span>, dtype(<span class="string">'O'</span>):   key1 key2</span><br><span class="line"> <span class="number">0</span>    a  one</span><br><span class="line"> <span class="number">1</span>    a  two</span><br><span class="line"> <span class="number">2</span>    b  one</span><br><span class="line"> <span class="number">3</span>    b  two</span><br><span class="line"> <span class="number">4</span>    a  one</span><br></pre></td></tr></table></figure>
<p>选取一个或者一组列</p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic4.png" alt="pic4"><br>对于大数据，很多情况是只需要对部分列进行聚合</p>
<p>df.groupby([‘key1’,’key2’])[[‘data2’]].mean()</p>
<p>通过字典或者series进行分组<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">people=pd.DataFrame(np.random.randn(<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">                   columns=list(<span class="string">'abcde'</span>),</span><br><span class="line">                   index=[<span class="string">'Joe'</span>,<span class="string">'Steve'</span>,<span class="string">'Wes'</span>,<span class="string">'Jim'</span>,<span class="string">'Travis'</span>])</span><br><span class="line"></span><br><span class="line">people.ix[<span class="number">2</span>:<span class="number">3</span>,[<span class="string">'b'</span>,<span class="string">'c'</span>]]=np.nan <span class="comment">#设置几个nan</span></span><br><span class="line">people</span><br></pre></td></tr></table></figure></p>
<p>已知列的分组关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mapping=&#123;<span class="string">'a'</span>:<span class="string">'red'</span>,<span class="string">'b'</span>:<span class="string">'red'</span>,<span class="string">'c'</span>:<span class="string">'blue'</span>,<span class="string">'d'</span>:<span class="string">'blue'</span>,<span class="string">'e'</span>:<span class="string">'red'</span>,<span class="string">'f'</span>:<span class="string">'orange'</span>&#125;</span><br><span class="line"></span><br><span class="line">by_column=people.groupby(mapping,axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">by_column.sum()</span><br></pre></td></tr></table></figure></p>
<p>如果不加axis=1, 则只会出现 a b c d e</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">map_series=pd.Series(mapping)</span><br><span class="line">map_series</span><br><span class="line"></span><br><span class="line">a       red</span><br><span class="line">b       red</span><br><span class="line">c      blue</span><br><span class="line">d      blue</span><br><span class="line">e       red</span><br><span class="line">f    orange</span><br><span class="line">dtype: object</span><br><span class="line"></span><br><span class="line">people.groupby(map_series,axis=<span class="number">1</span>).count()</span><br></pre></td></tr></table></figure>
<p>根据索引级别进行分组</p>
<p>层次化索引最方便的地方就在于他能够根据索引级别进行聚合。要实现该目的，通过level关键字出入级别编号或者名称即可:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">columns=pd.MultiIndex.from_arrays([[<span class="string">'US'</span>,<span class="string">'US'</span>,<span class="string">'US'</span>,<span class="string">'JP'</span>,<span class="string">'JP'</span>],[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>]],names=[<span class="string">'cty'</span>,<span class="string">'tenor'</span>])</span><br><span class="line">hier_df=pd.DataFrame(np.random.randn(<span class="number">4</span>,<span class="number">5</span>),columns=columns)</span><br><span class="line">hier_df</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hier_df.groupby(level=<span class="string">'cty'</span>,axis=<span class="number">1</span>).count()</span><br></pre></td></tr></table></figure>
<p>数据聚合<br>调用自定义的聚合函数<br><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic5.png" alt="pic5"></p>
<p>面向列的多函数应用<br>对Series或者DataFrame列的聚合运算实际是使用aggregate或者调用mean，std等方法。下面我们想对不同的列使用不同的聚合函数，或者一次应用多个函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grouped=tips.groupby([<span class="string">'sex'</span>,<span class="string">'smoker'</span>])</span><br><span class="line">grouped_pct=grouped[<span class="string">'tip_pct'</span>] <span class="comment">#tip_pct列</span></span><br><span class="line">grouped_pct.agg(<span class="string">'mean'</span>)<span class="comment">#对与9-1图标中描述的统计，可以将函数名直接以字符串传入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果传入一组函数，得到的df的列名就会以相应的函数命名</span></span><br></pre></td></tr></table></figure></p>
<p>自动给出的列名辨识度低，如果传入的是(name, function)元组组成的列表，则各个元组的第一个元素将被用作df的列名</p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic6.png" alt="pic6"><br>如果想对不同的列应用不同的函数, 具体的办法是想agg传入一个从列名映射到函数的字典</p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic7.png" alt="pic7"></p>
<p>分组级运算和转换<br>聚合只是分组运算的一种，它是数据转换的特列。transform 和apply更牛叉.</p>
<p>transform会将一个函数应用到各个分组，然后将结果放在适当的位置. 如果各分组产生的标量值，则该标量值会被广播出去。</p>
<p>transform也是有严格条件的特殊函数：传入的函数只能产生两种结果，要么产生一个可以广播的标量值(如：np.mean), 要么产生一个相同大小的结果数组。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">people=pd.DataFrame(np.random.randn(<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">                   columns=list(<span class="string">'abcde'</span>),</span><br><span class="line">                   index=[<span class="string">'Joe'</span>,<span class="string">'Steve'</span>,<span class="string">'Wes'</span>,<span class="string">'Jim'</span>,<span class="string">'Travis'</span>])</span><br><span class="line">people</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">key=[<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'one'</span>]</span><br><span class="line">people.groupby(key).mean()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.groupby(key).transform(np.mean)</span><br></pre></td></tr></table></figure>
<p>可以看到有很多与表2一样的值。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demean</span><span class="params">(arr)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> arr-arr.mean()</span><br><span class="line"></span><br><span class="line">demeaned=people.groupby(key).transform(demean)</span><br><span class="line">demeaned</span><br><span class="line">demeaned.groupby(key).mean()</span><br></pre></td></tr></table></figure></p>
<p>最一般化的groupby 方法是apply.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tips=pd.read_csv(<span class="string">'C:\\Users\\ecaoyng\\Desktop\\work space\\Python\\py_for_analysis_code\\pydata-book-master\\ch08\\tips.csv'</span>)</span><br><span class="line">tips[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure></p>
<p>新生成一列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tips[<span class="string">'tip_pct'</span>]=tips[<span class="string">'tip'</span>]/tips[<span class="string">'total_bill'</span>]</span><br><span class="line">tips[:<span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<p>根据分组选出最高的5个tip_pct值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(df,n=<span class="number">5</span>,column=<span class="string">'tip_pct'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> df.sort_index(by=column)[-n:]</span><br><span class="line">top(tips,n=<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<p>对smoker分组并应用该函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tips.groupby(<span class="string">'smoker'</span>).apply(top)</span><br></pre></td></tr></table></figure></p>
<p>多参数版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tips.groupby([<span class="string">'smoker'</span>,<span class="string">'day'</span>]).apply(top,n=<span class="number">1</span>,column=<span class="string">'total_bill'</span>)</span><br></pre></td></tr></table></figure>
<p>分位数和桶分析<br>cut and qcut与groupby结合起来，能轻松的对数据集的桶(bucket)或者分位数(quantile)分析。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frame=pd.DataFrame(&#123;<span class="string">'data1'</span>:np.random.randn(<span class="number">1000</span>),</span><br><span class="line">                   <span class="string">'data2'</span>: np.random.randn(<span class="number">1000</span>)&#125;)</span><br><span class="line">frame[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">factor=pd.cut(frame.data1,<span class="number">4</span>)</span><br><span class="line">factor[:<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>    (<span class="number">0.281</span>, <span class="number">2.00374</span>]</span><br><span class="line"><span class="number">1</span>    (<span class="number">0.281</span>, <span class="number">2.00374</span>]</span><br><span class="line"><span class="number">2</span>    (<span class="number">-3.172</span>, <span class="number">-1.442</span>]</span><br><span class="line"><span class="number">3</span>     (<span class="number">-1.442</span>, <span class="number">0.281</span>]</span><br><span class="line"><span class="number">4</span>    (<span class="number">0.281</span>, <span class="number">2.00374</span>]</span><br><span class="line"><span class="number">5</span>    (<span class="number">0.281</span>, <span class="number">2.00374</span>]</span><br><span class="line"><span class="number">6</span>     (<span class="number">-1.442</span>, <span class="number">0.281</span>]</span><br><span class="line"><span class="number">7</span>     (<span class="number">-1.442</span>, <span class="number">0.281</span>]</span><br><span class="line"><span class="number">8</span>     (<span class="number">-1.442</span>, <span class="number">0.281</span>]</span><br><span class="line"><span class="number">9</span>     (<span class="number">-1.442</span>, <span class="number">0.281</span>]</span><br><span class="line">Name: data1, dtype: category</span><br><span class="line">Categories (<span class="number">4</span>, object): [(<span class="number">-3.172</span>, <span class="number">-1.442</span>] &lt; (<span class="number">-1.442</span>, <span class="number">0.281</span>] &lt; (<span class="number">0.281</span>, <span class="number">2.00374</span>] &lt; (<span class="number">2.00374</span>, <span class="number">3.727</span>]]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_stats</span><span class="params">(group)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'min'</span>:group.min(),<span class="string">'max'</span>:group.max(),<span class="string">'count'</span>:group.count(),<span class="string">'mean'</span>:group.mean()&#125;</span><br><span class="line">grouped=frame.data2.groupby(factor)</span><br><span class="line">grouped.apply(get_stats).unstack()</span><br></pre></td></tr></table></figure>
<p>这些都是长度相等的桶，要根据样本分为数得到大小相等的桶，使用qcut即可.</p>
<p>长度相等的桶：区间大小相等<br>大小相等的桶：数据点数量相等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grouping=pd.qcut(frame.data1,<span class="number">10</span>,labels=<span class="keyword">False</span>)<span class="comment">#label=false即可值获取分位数的编号</span></span><br><span class="line">grouped=frame.data2.groupby(grouping)</span><br><span class="line">grouped.apply(get_stats).unstack()</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>groupby操作都涉及原始对象的以下操作之一.</p>
<ul>
<li>分割对象</li>
<li>应用一个函数</li>
<li>结合的结果<br>在许多情况下,我们将数据分成多个集合,并在每个子集上应用一些函数.在应用函数中,可以执行以下操作:</li>
<li>聚合(计算汇总统计)</li>
<li>转换(执行一些特定于组的操作)</li>
<li>过滤(在某些情况下丢弃数据)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df)</span><br></pre></td></tr></table></figure>
<p>将数据拆分成组<br>pandas 对象可以分成任何对象.有多种方式拆分对象,如:</p>
<ul>
<li>obj.groupby(‘key’)</li>
<li>obj.groupby([‘key1’,’key2’])</li>
<li>obj.groupby(key,axis=1)</li>
</ul>
<p>现在来看看如何将分组对象应用于DataFrame对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df.groupby(<span class="string">'Team'</span>))</span><br></pre></td></tr></table></figure></p>
<p>查看分组<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],           <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df.groupby(<span class="string">'Team'</span>).groups)</span><br></pre></td></tr></table></figure></p>
<p>按多列分组<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"><span class="keyword">print</span> (df.groupby([<span class="string">'Team'</span>,<span class="string">'Year'</span>]).groups)</span><br></pre></td></tr></table></figure></p>
<p>迭代遍历分组<br>使用groupby对象，可以遍历类似itertools.obj的对象。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line">grouped = df.groupby(<span class="string">'Year'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name,group <span class="keyword">in</span> grouped:</span><br><span class="line">    <span class="keyword">print</span> (name)</span><br><span class="line">    <span class="keyword">print</span> (group)</span><br></pre></td></tr></table></figure></p>
<p>默认情况下，groupby对象具有与分组名相同的标签名称。</p>
<p>选择一个分组<br>使用get_group()方法，可以选择一个组。参考以下示例代码 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line">grouped = df.groupby(<span class="string">'Year'</span>)</span><br><span class="line"><span class="keyword">print</span> (grouped.get_group(<span class="number">2014</span>))</span><br></pre></td></tr></table></figure></p>
<p>聚合<br>聚合函数为每个组返回单个聚合值。当创建了分组(group by)对象，就可以对分组数据执行多个聚合操作。<br>一个比较常用的是通过聚合或等效的agg方法聚合 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line">grouped = df.groupby(<span class="string">'Year'</span>)</span><br><span class="line"><span class="keyword">print</span> (grouped[<span class="string">'Points'</span>].agg(np.mean))</span><br></pre></td></tr></table></figure></p>
<p>一次应用多个聚合函数<br>通过分组系列，还可以传递函数的列表或字典来进行聚合，并生成DataFrame作为输出 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line">grouped = df.groupby(<span class="string">'Team'</span>)</span><br><span class="line">agg = grouped[<span class="string">'Points'</span>].agg([np.sum, np.mean, np.std])</span><br><span class="line"><span class="keyword">print</span> (agg)</span><br></pre></td></tr></table></figure></p>
<p>转换<br>分组或列上的转换返回索引大小与被分组的索引相同的对象。因此，转换应该返回与组块大小相同的结果。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line"></span><br><span class="line">grouped = df.groupby(<span class="string">'Team'</span>)</span><br><span class="line">score = <span class="keyword">lambda</span> x: (x - x.mean()) / x.std()*<span class="number">10</span></span><br><span class="line"><span class="keyword">print</span> (grouped.transform(score))</span><br></pre></td></tr></table></figure></p>
<p>过滤<br>过滤根据定义的标准过滤数据并返回数据的子集。filter()函数用于过滤数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">ipl_data = &#123;<span class="string">'Team'</span>: [<span class="string">'Riders'</span>, <span class="string">'Riders'</span>, <span class="string">'Devils'</span>, <span class="string">'Devils'</span>, <span class="string">'Kings'</span>,</span><br><span class="line">         <span class="string">'kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Kings'</span>, <span class="string">'Riders'</span>, <span class="string">'Royals'</span>, <span class="string">'Royals'</span>, <span class="string">'Riders'</span>],</span><br><span class="line">         <span class="string">'Rank'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">4</span> ,<span class="number">1</span> ,<span class="number">1</span>,<span class="number">2</span> , <span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">         <span class="string">'Year'</span>: [<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2016</span>,<span class="number">2017</span>,<span class="number">2016</span>,<span class="number">2014</span>,<span class="number">2015</span>,<span class="number">2017</span>],</span><br><span class="line">         <span class="string">'Points'</span>:[<span class="number">876</span>,<span class="number">789</span>,<span class="number">863</span>,<span class="number">673</span>,<span class="number">741</span>,<span class="number">812</span>,<span class="number">756</span>,<span class="number">788</span>,<span class="number">694</span>,<span class="number">701</span>,<span class="number">804</span>,<span class="number">690</span>]&#125;</span><br><span class="line">df = pd.DataFrame(ipl_data)</span><br><span class="line">filter = df.groupby(<span class="string">'Team'</span>).filter(<span class="keyword">lambda</span> x: len(x) &gt;= <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (filter)</span><br></pre></td></tr></table></figure></p>
<h2 id="pandas-窗口函数"><a href="#pandas-窗口函数" class="headerlink" title="pandas 窗口函数"></a>pandas 窗口函数</h2><p>为了处理数字数据，Pandas提供了几个变体，如滚动，展开和指数移动窗口统计的权重。 其中包括总和，均值，中位数，方差，协方差，相关性等。</p>
<h3 id="rolling-函数"><a href="#rolling-函数" class="headerlink" title=".rolling()函数"></a>.rolling()函数</h3><p>这个函数可以应用于一系列数据.指定window=n参数并在其上应用适当的统计函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>),</span><br><span class="line">index = pd.date_range(<span class="string">'1/1/2020'</span>, periods=<span class="number">10</span>),</span><br><span class="line">columns = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df.rolling(window=<span class="number">3</span>).mean())</span><br></pre></td></tr></table></figure></p>
<p>注 - 由于窗口大小为3(window)，前两个元素有空值，第三个元素的值将是n，n-1和n-2元素的平均值。这样也可以应用上面提到的各种函数了。</p>
<h3 id="expanding-函数"><a href="#expanding-函数" class="headerlink" title=".expanding()函数"></a>.expanding()函数</h3><p>这个函数可以应用于一系列数据。 指定min_periods = n参数并在其上应用适当的统计函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>),</span><br><span class="line">      index = pd.date_range(<span class="string">'1/1/2018'</span>, periods=<span class="number">10</span>),</span><br><span class="line">      columns = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line"><span class="keyword">print</span> (df.expanding(min_periods=<span class="number">3</span>).mean())</span><br></pre></td></tr></table></figure></p>
<h3 id="ewm-函数"><a href="#ewm-函数" class="headerlink" title=".ewm()函数"></a>.ewm()函数</h3><p>ewm()可应用于系列数据。指定com，span，halflife参数，并在其上应用适当的统计函数。它以指数形式分配权重。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>),</span><br><span class="line">   index = pd.date_range(<span class="string">'1/1/2019'</span>, periods=<span class="number">10</span>),</span><br><span class="line">   columns = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</span><br><span class="line"><span class="keyword">print</span> (df.ewm(com=<span class="number">0.5</span>).mean())</span><br></pre></td></tr></table></figure></p>
<p>窗口函数主要用于通过平滑曲线来以图形方式查找数据内的趋势。如果日常数据中有很多变化，并且有很多数据点可用，那么采样和绘图就是一种方法，应用窗口计算并在结果上绘制图形是另一种方法。 通过这些方法，可以平滑曲线或趋势。</p>
<h2 id="Pandas缺失数据"><a href="#Pandas缺失数据" class="headerlink" title="Pandas缺失数据"></a>Pandas缺失数据</h2><p>数据丢失(缺失)在现实生活中总是一个问题。 机器学习和数据挖掘等领域由于数据缺失导致的数据质量差，在模型预测的准确性上面临着严重的问题。 在这些领域，缺失值处理是使模型更加准确和有效的重点。</p>
<h3 id="何时以及为什么数据丢失？"><a href="#何时以及为什么数据丢失？" class="headerlink" title="何时以及为什么数据丢失？"></a>何时以及为什么数据丢失？</h3><p>想象一下有一个产品的在线调查。很多时候，人们不会分享与他们有关的所有信息。 很少有人分享他们的经验，但不是他们使用产品多久; 很少有人分享使用产品的时间，经验，但不是他们的个人联系信息。 因此，以某种方式或其他方式，总会有一部分数据总是会丢失，这是非常常见的现象。<br>现在来看看如何处理使用Pandas的缺失值(如NA或NaN)。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df)</span><br></pre></td></tr></table></figure></p>
<p>使用重构索引(reindexing)，创建了一个缺少值的DataFrame。 在输出中，NaN表示不是数字的值。</p>
<h3 id="检查缺失值"><a href="#检查缺失值" class="headerlink" title="检查缺失值"></a>检查缺失值</h3><p>为了更容易地检测缺失值(以及跨越不同的数组dtype)，Pandas提供了isnull()和notnull()函数，它们也是Series和DataFrame对象的方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df[<span class="string">'one'</span>].isnull())</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(5, 3), index=[&apos;a&apos;, &apos;c&apos;, &apos;e&apos;, &apos;f&apos;,</span><br><span class="line">&apos;h&apos;],columns=[&apos;one&apos;, &apos;two&apos;, &apos;three&apos;])</span><br><span class="line"></span><br><span class="line">df = df.reindex([&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;])</span><br><span class="line"></span><br><span class="line">print (df[&apos;one&apos;].notnull())</span><br></pre></td></tr></table></figure>
<h3 id="缺少数据的计算"><a href="#缺少数据的计算" class="headerlink" title="缺少数据的计算"></a>缺少数据的计算</h3><ul>
<li>在求和数据时, NA将被视为0</li>
<li>如果数据全部是NA,那么结果将是NA<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df[<span class="string">'one'</span>].sum())</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(index=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],columns=[<span class="string">'one'</span>,<span class="string">'two'</span>])</span><br><span class="line"><span class="keyword">print</span> (df[<span class="string">'one'</span>].sum())</span><br></pre></td></tr></table></figure>
<h3 id="清理-填充缺少数据"><a href="#清理-填充缺少数据" class="headerlink" title="清理/填充缺少数据"></a>清理/填充缺少数据</h3><p>Pandas提供了各种方法来清除缺失的值。fillna()函数可以通过几种方法用非空数据“填充”NA值，在下面的章节中将学习和使用。</p>
<h3 id="用标量值替换NaN"><a href="#用标量值替换NaN" class="headerlink" title="用标量值替换NaN"></a>用标量值替换NaN</h3><p>以下程序显示如何用0替换NaN。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">3</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>],columns=[<span class="string">'one'</span>,</span><br><span class="line"><span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"><span class="keyword">print</span> (df)</span><br><span class="line"><span class="keyword">print</span> (<span class="string">"NaN replaced with '0':"</span>)</span><br><span class="line"><span class="keyword">print</span> (df.fillna(<span class="number">0</span>))</span><br></pre></td></tr></table></figure></p>
<p>在这里填充零值; 当然，也可以填写任何其他的值。</p>
<h3 id="填写NA前进和后退"><a href="#填写NA前进和后退" class="headerlink" title="填写NA前进和后退"></a>填写NA前进和后退</h3><p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic8.png" alt="pic8"><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (df.fillna(method=<span class="string">'pad'</span>))</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"><span class="keyword">print</span> (df.fillna(method=<span class="string">'backfill'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="丢失缺少的值"><a href="#丢失缺少的值" class="headerlink" title="丢失缺少的值"></a>丢失缺少的值</h3><p>如果只想排除缺少的值，则使用dropna函数和axis参数。 默认情况下，axis = 0，即在行上应用，这意味着如果行内的任何值是NA，那么整个行被排除。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"><span class="keyword">print</span> (df.dropna())</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line"><span class="string">'h'</span>],columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</span><br><span class="line"></span><br><span class="line">df = df.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>])</span><br><span class="line"><span class="keyword">print</span> (df.dropna(axis=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<h3 id="替换丢失-或-通用值"><a href="#替换丢失-或-通用值" class="headerlink" title="替换丢失(或)通用值"></a>替换丢失(或)通用值</h3><p>很多时候，必须用一些具体的值取代一个通用的值。可以通过应用替换方法来实现这一点。<br>用标量值替换NA是fillna()函数的等效行为。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">'one'</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">2000</span>],</span><br><span class="line"><span class="string">'two'</span>:[<span class="number">1000</span>,<span class="number">0</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>]&#125;)</span><br><span class="line"><span class="keyword">print</span> (df.replace(&#123;<span class="number">1000</span>:<span class="number">10</span>,<span class="number">2000</span>:<span class="number">60</span>&#125;))</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">'one'</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">2000</span>],</span><br><span class="line"><span class="string">'two'</span>:[<span class="number">1000</span>,<span class="number">0</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>]&#125;)</span><br><span class="line"><span class="keyword">print</span> (df.replace(&#123;<span class="number">1000</span>:<span class="number">10</span>,<span class="number">2000</span>:<span class="number">60</span>&#125;))</span><br></pre></td></tr></table></figure>
<h2 id="Pandas合并-连接"><a href="#Pandas合并-连接" class="headerlink" title="Pandas合并/连接"></a>Pandas合并/连接</h2><p>Pandas具有功能全面的高性能内存中连接操作，与SQL等关系数据库非常相似。Pandas提供了一个单独的merge()函数，作为DataFrame对象之间所有标准数据库连接操作的入口<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.merge(left, right, how=<span class="string">'inner'</span>, on=<span class="keyword">None</span>, left_on=<span class="keyword">None</span>, right_on=<span class="keyword">None</span>,</span><br><span class="line">left_index=<span class="keyword">False</span>, right_index=<span class="keyword">False</span>, sort=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>在这里，有以下几个参数可以使用</p>
<ul>
<li>left ——一个DataFrame对象</li>
<li>right ——另一个DataFRame对象</li>
<li>on ——列(名称)连接,必须在左和右DataFrame对象中存在(找到)</li>
<li>left_on ——左侧DataFrame中的列用作键，可以是列名或长度等于DataFrame长度的数组</li>
<li>right_on ——来自右的DataFrame的列作为键,可以是列名或长度等于DataFrame长度的数组</li>
<li>left_index ——如果为True，则使用左侧DataFrame中的索引(行标签)作为其连接键.在具有MultiIndex(分层)的DataFrame的情况下,级别的数量必须与来自右DataFrame的连接键的数量相匹配</li>
<li>right_index ——与右DataFrame的left_index具有相同用法</li>
<li>how——它是left,right,outer以及inner之中的一个,默认为inner</li>
<li>sort——按照字典顺序通过连接键对结果DataFrame进行排序.默认为True,设置为False时,在很多情况下大大提高性能</li>
</ul>
<p>现在创建两个不同的DataFrame并对其执行合并操作。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line"><span class="keyword">print</span> (left)</span><br><span class="line">print(<span class="string">"========================================"</span>)</span><br><span class="line"><span class="keyword">print</span> (right)</span><br></pre></td></tr></table></figure></p>
<h3 id="在一个键上合并两个数据帧"><a href="#在一个键上合并两个数据帧" class="headerlink" title="在一个键上合并两个数据帧"></a>在一个键上合并两个数据帧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left,right,on=<span class="string">'id'</span>)</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure>
<h3 id="合并多个键上的两个数据框"><a href="#合并多个键上的两个数据框" class="headerlink" title="合并多个键上的两个数据框"></a>合并多个键上的两个数据框</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left,right,on=[<span class="string">'id'</span>,<span class="string">'subject_id'</span>])</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure>
<h3 id="合并使用“how”的参数"><a href="#合并使用“how”的参数" class="headerlink" title="合并使用“how”的参数"></a>合并使用“how”的参数</h3><p>如何合并参数指定如何确定哪些键将被包含在结果表中。如果组合键没有出现在左侧或右侧表中，则连接表中的值将为NA。<br>这里是how选项和SQL等效名称的总结<br><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic9.png" alt="pic9"></p>
<p>Left Join示例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left, right, on=<span class="string">'subject_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line"><span class="keyword">print</span> (rs)</span><br></pre></td></tr></table></figure></p>
<p>Right Join示例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left, right, on=<span class="string">'subject_id'</span>, how=<span class="string">'right'</span>)</span><br><span class="line"><span class="keyword">print</span> (rs)</span><br></pre></td></tr></table></figure></p>
<p>Outer Join示例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left, right, how=<span class="string">'outer'</span>, on=<span class="string">'subject_id'</span>)</span><br><span class="line"><span class="keyword">print</span> (rs)</span><br></pre></td></tr></table></figure></p>
<p>Inner Join示例<br>连接将在索引上进行。连接(Join)操作将授予它所调用的对象。所以，a.join(b)不等于b.join(a)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">left = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(</span><br><span class="line">         &#123;<span class="string">'id'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>]&#125;)</span><br><span class="line">rs = pd.merge(left, right, on=<span class="string">'subject_id'</span>, how=<span class="string">'inner'</span>)</span><br><span class="line"><span class="keyword">print</span> (rs)</span><br></pre></td></tr></table></figure></p>
<h2 id="Pandas级联"><a href="#Pandas级联" class="headerlink" title="Pandas级联"></a>Pandas级联</h2><p>Pandas提供了各种工具(功能)，可以轻松地将Series，DataFrame和Panel对象组合在一起。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.concat(objs,axis=<span class="number">0</span>,join=<span class="string">'outer'</span>,join_axes=<span class="keyword">None</span>,</span><br><span class="line">ignore_index=<span class="keyword">False</span>)原文出自【易百教程】，商业转载请联系作者获得授权，非商业请保留原文链接：https://www.yiibai.com/pandas/python_pandas_concatenation.htm</span><br></pre></td></tr></table></figure></p>
<p>其中，</p>
<ul>
<li>objs——这是Series，DataFrame或Panel对象的序列或映射。</li>
<li>axis——{0，1，…}，默认为0，这是连接的轴。</li>
<li>join——{‘inner’, ‘outer’}，默认inner。如何处理其他轴上的索引。联合的外部和交叉的内部。</li>
<li>ignore_index ——布尔值，默认为False。如果指定为True，则不要使用连接轴上的索引值。结果轴将被标记为：0，…，n-1。</li>
<li>join_axes ——这是Index对象的列表。用于其他(n-1)轴的特定索引，而不是执行内部/外部集逻辑。</li>
</ul>
<h3 id="连接对象"><a href="#连接对象" class="headerlink" title="连接对象"></a>连接对象</h3><p>concat()函数完成了沿轴执行级联操作的所有重要工作。下面代码中，创建不同的对象并进行连接。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = pd.concat([one,two])</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure></p>
<p>假设想把特定的键与每个碎片的DataFrame关联起来。可以通过使用键参数来实现这一点 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = pd.concat([one,two],keys=[<span class="string">'x'</span>,<span class="string">'y'</span>])</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure></p>
<p>结果的索引是重复的; 每个索引重复。如果想要生成的对象必须遵循自己的索引，请将ignore_index设置为True。参考以下示例代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = pd.concat([one,two],keys=[<span class="string">'x'</span>,<span class="string">'y'</span>],ignore_index=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure></p>
<p>观察，索引完全改变，键也被覆盖。如果需要沿axis=1添加两个对象，则会添加新列。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = pd.concat([one,two],axis=<span class="number">1</span>)</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure>
<p>使用附加连接<br>连接的一个有用的快捷方式是在Series和DataFrame实例的append方法。这些方法实际上早于concat()方法。 它们沿axis=0连接，即索引<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = one.append(two)</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure></p>
<p>append()函数也可以带多个对象 -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">one = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub1'</span>,<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">98</span>,<span class="number">90</span>,<span class="number">87</span>,<span class="number">69</span>,<span class="number">78</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">two = pd.DataFrame(&#123;</span><br><span class="line">         <span class="string">'Name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</span><br><span class="line">         <span class="string">'subject_id'</span>:[<span class="string">'sub2'</span>,<span class="string">'sub4'</span>,<span class="string">'sub3'</span>,<span class="string">'sub6'</span>,<span class="string">'sub5'</span>],</span><br><span class="line">         <span class="string">'Marks_scored'</span>:[<span class="number">89</span>,<span class="number">80</span>,<span class="number">79</span>,<span class="number">97</span>,<span class="number">88</span>]&#125;,</span><br><span class="line">         index=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">rs = one.append([two,one,two])</span><br><span class="line">print(rs)</span><br></pre></td></tr></table></figure>
<h2 id="时间序列"><a href="#时间序列" class="headerlink" title="时间序列"></a>时间序列</h2><p>Pandas为时间序列数据的工作时间提供了一个强大的工具，尤其是在金融领域。在处理时间序列数据时，我们经常遇到以下情况 -</p>
<ul>
<li>生成时间序列将时间序列转换为不同的频率</li>
<li>Pandas提供了一个相对紧凑和自包含的工具来执行上述任务。</li>
</ul>
<h3 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h3><p>datetime.now()用于获取当前的日期和时间。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">print</span> pd.datetime.now()</span><br></pre></td></tr></table></figure></p>
<p>创建一个时间戳<br>时间戳数据是时间序列数据的最基本类型，它将数值与时间点相关联。 对于Pandas对象来说，意味着使用时间点。举个例子 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">time = pd.Timestamp(<span class="string">'2018-11-01'</span>)</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>
<p>也可以转换整数或浮动时期。这些的默认单位是纳秒(因为这些是如何存储时间戳的)。 然而，时代往往存储在另一个可以指定的单元中。 再举一个例子 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">time = pd.Timestamp(<span class="number">1588686880</span>,unit=<span class="string">'s'</span>)</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>
<h3 id="创建一个时间范围"><a href="#创建一个时间范围" class="headerlink" title="创建一个时间范围"></a>创建一个时间范围</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">time = pd.date_range(<span class="string">"12:00"</span>, <span class="string">"23:59"</span>, freq=<span class="string">"30min"</span>).time</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure>
<p>改变时间的频率<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">time = pd.date_range(<span class="string">"12:00"</span>, <span class="string">"23:59"</span>, freq=<span class="string">"H"</span>).time</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>
<p>转换为时间戳<br>要转换类似日期的对象(例如字符串，时代或混合)的序列或类似列表的对象，可以使用to_datetime函数。当传递时将返回一个Series(具有相同的索引)，而类似列表被转换为DatetimeIndex。 看看下面的例子 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">time = pd.to_datetime(pd.Series([<span class="string">'Jul 31, 2009'</span>,<span class="string">'2019-10-10'</span>, <span class="keyword">None</span>]))</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>
<p>NaT表示不是一个时间的值(相当于NaN)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">time = pd.to_datetime([<span class="string">'2009/11/23'</span>, <span class="string">'2019.12.31'</span>, <span class="keyword">None</span>])</span><br><span class="line">print(time)</span><br></pre></td></tr></table></figure></p>
<h2 id="Pandas时间差"><a href="#Pandas时间差" class="headerlink" title="Pandas时间差"></a>Pandas时间差</h2><p>时间差(Timedelta)是时间上的差异，以不同的单位来表示。例如：日，小时，分钟，秒。它们可以是正值，也可以是负值。可以使用各种参数创建Timedelta对象，如下所示 -</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>通过传递字符串，可以创建一个timedelta对象。参考以下示例代码 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">timediff = pd.Timedelta(<span class="string">'2 days 2 hours 15 minutes 30 seconds'</span>)</span><br><span class="line">print(timediff)</span><br></pre></td></tr></table></figure></p>
<h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3><p>通过传递一个整数值与指定单位，这样的一个参数也可以用来创建Timedelta对象。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">timediff = pd.Timedelta(<span class="number">6</span>,unit=<span class="string">'h'</span>)</span><br><span class="line">print(timediff)</span><br></pre></td></tr></table></figure></p>
<h3 id="数据偏移"><a href="#数据偏移" class="headerlink" title="数据偏移"></a>数据偏移</h3><p>例如 - 周，天，小时，分钟，秒，毫秒，微秒，纳秒的数据偏移也可用于构建。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">timediff = pd.Timedelta(days=<span class="number">2</span>)</span><br><span class="line">print(timediff)</span><br></pre></td></tr></table></figure></p>
<h3 id="运算操作"><a href="#运算操作" class="headerlink" title="运算操作"></a>运算操作</h3><p>可以在Series/DataFrames上执行运算操作，并通过在datetime64 [ns]系列或在时间戳上减法操作来构造timedelta64 [ns]系列。参考以下示例代码 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series(pd.date_range(<span class="string">'2012-1-1'</span>, periods=<span class="number">3</span>, freq=<span class="string">'D'</span>))</span><br><span class="line">td = pd.Series([ pd.Timedelta(days=i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>) ])</span><br><span class="line">df = pd.DataFrame(dict(A = s, B = td))</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>相加操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series(pd.date_range(<span class="string">'2018-1-1'</span>, periods=<span class="number">3</span>, freq=<span class="string">'D'</span>))</span><br><span class="line">td = pd.Series([ pd.Timedelta(days=i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>) ])</span><br><span class="line">df = pd.DataFrame(dict(A = s, B = td))</span><br><span class="line">df[<span class="string">'C'</span>]=df[<span class="string">'A'</span>]+df[<span class="string">'B'</span>]</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
</li>
<li><p>相减操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">s = pd.Series(pd.date_range(<span class="string">'2012-1-1'</span>, periods=<span class="number">3</span>, freq=<span class="string">'D'</span>))</span><br><span class="line">td = pd.Series([ pd.Timedelta(days=i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>) ])</span><br><span class="line">df = pd.DataFrame(dict(A = s, B = td))</span><br><span class="line">df[<span class="string">'C'</span>]=df[<span class="string">'A'</span>]+df[<span class="string">'B'</span>]</span><br><span class="line">df[<span class="string">'D'</span>]=df[<span class="string">'C'</span>]-df[<span class="string">'B'</span>]</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Pandas-可视化"><a href="#Pandas-可视化" class="headerlink" title="Pandas 可视化"></a>Pandas 可视化</h2><p>基本绘图：绘图<br>Series和DataFrame上的这个功能只是使用matplotlib库的plot()方法的简单包装实现。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>,<span class="number">4</span>),index=pd.date_range(<span class="string">'2018/12/18'</span>,</span><br><span class="line">   periods=<span class="number">10</span>), columns=list(<span class="string">'ABCD'</span>))</span><br><span class="line"></span><br><span class="line">df.plot()</span><br></pre></td></tr></table></figure></p>
<p>如果索引由日期组成，则调用gct().autofmt_xdate()来格式化x轴，如上图所示。</p>
<p>我们可以使用x和y关键字绘制一列与另一列。</p>
<p>绘图方法允许除默认线图之外的少数绘图样式。 这些方法可以作为plot()的kind关键字参数提供。这些包括 -</p>
<ul>
<li>bar或barh为条形</li>
<li>hist为直方图</li>
<li>boxplot为盒型图</li>
<li>area为“面积”</li>
<li>scatter为散点图</li>
</ul>
<h3 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a>条形图</h3><p>现在通过创建一个条形图来看看条形图是什么。条形图可以通过以下方式来创建 -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>,<span class="number">4</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df.plot.bar()</span><br></pre></td></tr></table></figure>
<p>要生成一个堆积条形图，通过指定：pass stacked=True<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>,<span class="number">4</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df.plot.bar(stacked=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>要获得水平条形图，使用barh()方法 -<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>,<span class="number">4</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line"></span><br><span class="line">df.plot.barh(stacked=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h3><p>可以使用plot.hist()方法绘制直方图。我们可以指定bins的数量值。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">'a'</span>:np.random.randn(<span class="number">1000</span>)+<span class="number">1</span>,<span class="string">'b'</span>:np.random.randn(<span class="number">1000</span>),<span class="string">'c'</span>:</span><br><span class="line">np.random.randn(<span class="number">1000</span>) - <span class="number">1</span>&#125;, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"></span><br><span class="line">df.plot.hist(bins=<span class="number">20</span>)</span><br></pre></td></tr></table></figure></p>
<p>要为每列绘制不同的直方图，请使用以下代码 -</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df=pd.DataFrame(&#123;<span class="string">'a'</span>:np.random.randn(<span class="number">1000</span>)+<span class="number">1</span>,<span class="string">'b'</span>:np.random.randn(<span class="number">1000</span>),<span class="string">'c'</span>:</span><br><span class="line">np.random.randn(<span class="number">1000</span>) - <span class="number">1</span>&#125;, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line"></span><br><span class="line">df.hist(bins=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<h3 id="箱形图"><a href="#箱形图" class="headerlink" title="箱形图"></a>箱形图</h3><p>Boxplot可以绘制调用Series.box.plot()和DataFrame.box.plot()或DataFrame.boxplot()来可视化每列中值的分布。<br>例如，这里是一个箱形图，表示对[0,1)上的统一随机变量的10次观察的五次试验。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>, <span class="number">5</span>), columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>])</span><br><span class="line">df.plot.box()</span><br></pre></td></tr></table></figure>
<h2 id="区域块图形"><a href="#区域块图形" class="headerlink" title="区域块图形"></a>区域块图形</h2><p>可以使用Series.plot.area()或DataFrame.plot.area()方法创建区域图形。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df.plot.area()</span><br></pre></td></tr></table></figure></p>
<h3 id="散点图形"><a href="#散点图形" class="headerlink" title="散点图形"></a>散点图形</h3><p>可以使用DataFrame.plot.scatter()方法创建散点图。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">50</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</span><br><span class="line">df.plot.scatter(x=<span class="string">'a'</span>, y=<span class="string">'b'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="饼状图"><a href="#饼状图" class="headerlink" title="饼状图"></a>饼状图</h3><p>饼状图可以使用DataFrame.plot.pie()方法创建。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(<span class="number">3</span> * np.random.rand(<span class="number">4</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], columns=[<span class="string">'x'</span>])</span><br><span class="line">df.plot.pie(subplots=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="Pandas的10大秘籍"><a href="#Pandas的10大秘籍" class="headerlink" title="Pandas的10大秘籍"></a>Pandas的10大秘籍</h1><h2 id="read-cs"><a href="#read-cs" class="headerlink" title="read_cs"></a>read_cs</h2><p>是的，是的，这个基础函数你们早就都知道了。不过你们真的会用好它吗？如果你要载入的数据量非常大，试试 nrows = 5 这个参数，这样你就可以只载入表格的开头一小部分，而不是一口气读入整个表格啦。通过预览表格开头的几行，你可以对数据的特征有一定的了解，也避免了实际载入时选错分隔符的问题（毕竟有些数据并不都是用逗号隔开的）。</p>
<p>然后，你可以用 df.columns.tolist() 来获取表格的所有列的名称，进而用 usecols = [‘c1’, ‘c2’, …] 来载入你需要的列。而且，如果你直到某些列的数据格式，你还可以加上这样的参数来加快载入速度：dtype = {‘c1’: str, ‘c2’: int, …} 。一个额外的好处是，如果你数据表中的某一列既有数字又有字符串，你可以用这个方法将它们全部声明成字符串格式，这样你在合并表格的时候就可以用这一行做索引键，而不会碰到错误信息。</p>
<h2 id="select-dtypes"><a href="#select-dtypes" class="headerlink" title="select_dtypes"></a>select_dtypes</h2><p>如果你需要用 Python 做数据预处理，那你一定得用好这个函数，它能省下你不少时间。在读取表格之后，每一列都会有一个默认数据类型，比如 bool、int64、float64、object、category、timedelta64 和 datetime64 等。你可以用下面这行代码来检查具体有哪些类型：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.dtypes.value_counts()</span><br></pre></td></tr></table></figure></p>
<p>接着，可以用这样的代码来选中一个只含有数字类型的子数据表：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.select_dtypes(include=[<span class="string">'float64'</span>, <span class="string">'int64'</span>])</span><br></pre></td></tr></table></figure></p>
<h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><p>这是一个很重要的函数，可以帮你避免 Python 中对象引用可能产生的问题。</p>
<p>举个栗子，如果你有这样的一些代码：<br>‘’’python<br>import pandas as pd<br>df1 = pd.DataFrame({ ‘a’:[0,0,0], ‘b’: [1,1,1]})<br>df2 = df1<br>df2[‘a’] = df2[‘a’] + 1 df1.head()</p>
<p>‘’’<br>运行后，你会发现，如果你更改 df2 中的内容，df1 也会被改变。这是因为第 3 行的赋值语句 df2 = df1 并不是把 df1 的内容复制一份并赋值给 df2，而只是把 df2 变量指向了 df1 对象。因此，对 df2 的任何改变也会影响 df1。</p>
<p>为了避免这个问题，你需要对 df1 进行复制，并把复制的结果赋值给 df2。例如：</p>
<p>df2 = df1.copy()</p>
<p>或者你可以使用 deepcopy 库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from copy import deepcopy</span><br><span class="line"></span><br><span class="line">df2 = deepcopy(df1)</span><br></pre></td></tr></table></figure></p>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>这个超酷的函数，能让你简单方便地完成数据转换，特别是分类数据的转换工作。首先，你需要定义一个字典，作为转换模板。字典对象中的键(keys)是要查找的旧值，而值(values)是替换成的新值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">level_map = &#123;<span class="number">1</span>: <span class="string">'high'</span>, <span class="number">2</span>: <span class="string">'medium'</span>, <span class="number">3</span>: <span class="string">'low'</span>&#125;</span><br><span class="line"></span><br><span class="line">df[<span class="string">'c_level'</span>] = df[<span class="string">'c'</span>].map(level_map)</span><br></pre></td></tr></table></figure>
<p>日常工作中，我们在很多情况下会用到 map：将布尔值 True 和 False 分别替换成 1 和 0（建立数学模型）；定义级别名称；建立用户定义的词汇编码体系等。</p>
<h2 id="是否需要-apply-自定义函数？"><a href="#是否需要-apply-自定义函数？" class="headerlink" title="是否需要 apply 自定义函数？"></a>是否需要 apply 自定义函数？</h2><p>如果我们需要用几个不同的列的值，经过计算，生成一个新的列，那 apply() 函数常常会非常好用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rule</span><span class="params">(x, y)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> x == <span class="string">'high'</span> <span class="keyword">and</span> y &gt; <span class="number">10</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">else</span>: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">df = pd.DataFrame(&#123; <span class="string">'c1'</span>:[ <span class="string">'high'</span> ,<span class="string">'high'</span>, <span class="string">'low'</span>, <span class="string">'low'</span>], <span class="string">'c2'</span>: [<span class="number">0</span>, <span class="number">23</span>, <span class="number">17</span>, <span class="number">4</span>]&#125;)</span><br><span class="line"></span><br><span class="line">df[<span class="string">'new'</span>] = df.apply(<span class="keyword">lambda</span> x: rule(x[<span class="string">'c1'</span>], x[<span class="string">'c2'</span>]), axis = <span class="number">1</span>) df.head()</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们定义了一个处理两个输入数据的函数，然后用 apply() 函数把它应用到 c1 和 c2 两列的所有数据上，以此新增了一个 new 列。</p>
<p>但要注意， apply() 函数的问题在于，它运行起来速度比较慢。</p>
<p>比如，你想要得到 c1 和 c2 两列中每一行的最大值，你确实可以这样用 apply()：</p>
<p>df[‘maximum’] = df.apply(lambda x: max(x[‘c1’], x[‘c2’]), axis = 1)</p>
<p>但用内置的 max 速度会快得多，可读性也更好：</p>
<p>df[‘maximum’] = df[[‘c1’,’c2’]].max(axis =1)</p>
<p>划重点：如果能用内置函数完成的工作，就尽量别用 apply() 自定义函数的方法来搞，内置函数的速度一般都快得多。</p>
<p>再举个例子：如果你要把 c 列全部取整成 int 类型，用 round(df[‘c’]),0) 比自己写个函数来取整快多了。</p>
<h2 id="value-counts"><a href="#value-counts" class="headerlink" title="value_counts"></a>value_counts</h2><p>这是一个能计算数值分布情况的函数。例如，你想统计 c 列中可能出现的数值和每个数据的出现频率，只需要这样：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'c'</span>].value_counts()</span><br></pre></td></tr></table></figure></p>
<p>这个函数有几个超有用的参数：</p>
<ol>
<li>normalize = True: 统计出现频率而不是计数；</li>
<li>dropna = False: 把空值也纳入统计；</li>
<li>sort = False: 按值排序，而不是按计数的数量排序；</li>
<li>df[‘c’].value_counts().reset_index(): 将结果转换成 pandas 的数据表，以便进一步处理。</li>
</ol>
<h2 id="处理数据与缺失值"><a href="#处理数据与缺失值" class="headerlink" title="处理数据与缺失值"></a>处理数据与缺失值</h2><p>在构建模型的时候，你或许会需要排除那些缺失值太多的行（甚至有些行整行都是空的）。在这种情况下，你可以用 .isnull() 和 .sum() 来统计特定列里的缺失值数量。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.DataFrame(&#123; <span class="string">'id'</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="string">'c1'</span>:[<span class="number">0</span>,<span class="number">0</span>,np.nan], <span class="string">'c2'</span>: [np.nan,<span class="number">1</span>,<span class="number">1</span>]&#125;)</span><br><span class="line">df = df[[<span class="string">'id'</span>, <span class="string">'c1'</span>, <span class="string">'c2'</span>]]</span><br><span class="line">df[<span class="string">'num_nulls'</span>] = df[[<span class="string">'c1'</span>, <span class="string">'c2'</span>]].isnull().sum(axis=<span class="number">1</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure></p>
<h2 id="根据ID选择特定的行"><a href="#根据ID选择特定的行" class="headerlink" title="根据ID选择特定的行"></a>根据ID选择特定的行</h2><p>在 SQL 里，我们可以用这样的语句来按照 ID 选择记录： SELECT * FROM … WHERE ID in (‘A001’, ‘C022’, …) 。在 pandas 里，我们也可以做类似的操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df_filter = df[&apos;ID&apos;].isin([&apos;A001&apos;,&apos;C022&apos;,...])</span><br><span class="line">df[df_filter]</span><br></pre></td></tr></table></figure></p>
<h2 id="按百分比进行数据分组"><a href="#按百分比进行数据分组" class="headerlink" title="按百分比进行数据分组"></a>按百分比进行数据分组</h2><p>假设你有一列数值型的数据，你想要按相对大小进行分组，比如数字最大的前 5% 分到第一组，5%-20% 到第二组，20%-50% 第三组，最低的 50% 分到第四组。当然，你可以用 pandas.cut 来切分，但我个人有一个挺不错的小技巧来达到这个效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">cut_points = [np.percentile(df[<span class="string">'c'</span>], i) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">50</span>, <span class="number">80</span>, <span class="number">95</span>]]</span><br><span class="line">df[<span class="string">'group'</span>] = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">  df[<span class="string">'group'</span>] = df[<span class="string">'group'</span>] + (df[<span class="string">'c'</span>] &lt; cut_points[i]) <span class="comment"># 或者 &lt;= cut_points[i]</span></span><br></pre></td></tr></table></figure>
<p>因为不需要 apply()，所以这样做的处理速度更快。</p>
<h2 id="to-csv"><a href="#to-csv" class="headerlink" title="to_csv"></a>to_csv</h2><p>没错，这个函数大家都耳熟能详了。但我这里有两个很棒的小窍门，供你参考。</p>
<p>首先，你可以用这样的命令，查看表格被转换后要写入文件的前5行内容：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df[:<span class="number">5</span>].to_csv())</span><br></pre></td></tr></table></figure></p>
<p>其次，你可以同时处理混有整数（int）类型和缺失值的数据。如果一列数据同时含有缺失值和整数，它的数据类型可能还是浮点数（float），而不是整数。这种情况下，你可以在输出的时候加上 float_format=’%.0f’ 参数，这样所有输出的类型都会抹去小数点后面的数字，你就可以得到一张只有整数类型数据的表格啦。</p>
<h1 id="pandas透视表-pivot-Table"><a href="#pandas透视表-pivot-Table" class="headerlink" title="pandas透视表(pivot Table)"></a>pandas透视表(pivot Table)</h1><p>数据透视表（Pivot Table）是一种交互式的表，可以进行某些计算，如求和与计数等。所进行的计算与数据跟数据透视表中的排列有关。</p>
<p>之所以称为数据透视表，是因为可以动态地改变它们的版面布置，以便按照不同方式分析数据，也可以重新安排行号、列标和页字段。每一次改变版面布置时，数据透视表会立即按照新的布置重新计算数据。另外，如果原始数据发生更改，则可以更新数据透视表。</p>
<h2 id="为什么要用pivot-table"><a href="#为什么要用pivot-table" class="headerlink" title="为什么要用pivot_table"></a>为什么要用pivot_table</h2><ul>
<li>灵活性高，可以随意定制你的分析计算要求</li>
<li>脉络清晰易于理解数据</li>
<li>操作性强，报表神器<h2 id="如何使用pivot-table"><a href="#如何使用pivot-table" class="headerlink" title="如何使用pivot_table"></a>如何使用pivot_table</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pd.read_csv(<span class="string">'h:/James_Harden.csv'</span>,encoding=<span class="string">'utf8'</span>)</span><br><span class="line">df.tail()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic10.png" alt="pic10"><br><a href="http://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" target="_blank" rel="noopener">pandas.pivot_table - pandas 0.21.0 documentation</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pivot_table(data, values=<span class="keyword">None</span>, index=<span class="keyword">None</span>, columns=<span class="keyword">None</span>,aggfunc=<span class="string">'mean'</span>, fill_value=<span class="keyword">None</span>, margins=<span class="keyword">False</span>, dropna=<span class="keyword">True</span>, margins_name=<span class="string">'All'</span>)</span><br></pre></td></tr></table></figure></p>
<p>pivot_table有四个最重要的参数index、values、columns、aggfunc，本文以这四个参数为中心讲解pivot操作是如何进行。</p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><p>每个pivot_table必须拥有一个index，如果想查看哈登对阵每个队伍的得分，首先我们将对手设置为index：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[<span class="string">u'对手'</span>])</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic11.png" alt="pic11"><br>对手成为了第一层索引，还想看看对阵同一对手在不同主客场下的数据，试着将对手与胜负与主客场都设置为index<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[<span class="string">u'对手'</span>,<span class="string">u'主客场'</span>])</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic12.png" alt="pic12"><br>试着交换下它们的顺序，数据结果一样：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[<span class="string">u'主客场'</span>,<span class="string">u'对手'</span>])</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic13.png" alt="pic13"><br>看完上面几个操作，Index就是层次字段，要通过透视表获取什么信息就按照相应的顺序设置字段，所以在进行pivot之前你也需要足够了解你的数据。</p>
<h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><p>通过上面的操作，我们获取了james harden在对阵对手时的所有数据，而Values可以对需要的计算数据进行筛选，如果我们只需要james harden在主客场和不同胜负情况下的得分、篮板与助攻三项数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[<span class="string">u'主客场'</span>,<span class="string">u'胜负'</span>],values=[<span class="string">u'得分'</span>,<span class="string">u'助攻'</span>,<span class="string">u'篮板'</span>])</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic14.png" alt="pic14"></p>
<h2 id="Aggfunc"><a href="#Aggfunc" class="headerlink" title="Aggfunc"></a>Aggfunc</h2><p>aggfunc参数可以设置我们对数据聚合时进行的函数操作。</p>
<p>当我们未设置aggfunc时，它默认aggfunc=’mean’计算均值。我们还想要获得james harden在主客场和不同胜负情况下的总得分、总篮板、总助攻时：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[<span class="string">u'主客场'</span>,<span class="string">u'胜负'</span>],values=[<span class="string">u'得分'</span>,<span class="string">u'助攻'</span>,<span class="string">u'篮板'</span>],aggfunc=[np.sum,np.mean])</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic15.png" alt="pic15"></p>
<h2 id="Columns"><a href="#Columns" class="headerlink" title="Columns"></a>Columns</h2><p>Columns类似Index可以设置列层次字段，它不是一个必要参数，作为一种分割数据的可选方式。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#fill_value填充空值,margins=True进行汇总</span></span><br><span class="line">pd.pivot_table(df,index=[<span class="string">u'主客场'</span>],columns=[<span class="string">u'对手'</span>],values=[<span class="string">u'得分'</span>],aggfunc=[np.sum],fill_value=<span class="number">0</span>,margins=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic16.png" alt="pic16"><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table=pd.pivot_table(df,index=[<span class="string">u'对手'</span>,<span class="string">u'胜负'</span>],columns=[<span class="string">u'主客场'</span>],values=[<span class="string">u'得分'</span>,<span class="string">u'助攻'</span>,<span class="string">u'篮板'</span>],aggfunc=[np.mean],fill_value=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic17.png" alt="pic17"></p>
<h2 id="pivot-table-vs-groupby"><a href="#pivot-table-vs-groupby" class="headerlink" title="pivot_table vs. groupby"></a>pivot_table vs. groupby</h2><p>你应该理解了pivot_table的用法？是不是在哪见过？</p>
<p>对，Groupby！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.pivot_table(df,index=[字段<span class="number">1</span>],values=[字段<span class="number">2</span>],aggfunc=[函数],fill_value=<span class="number">0</span>)</span><br><span class="line">df.groupby([字段<span class="number">1</span>])[字段<span class="number">2</span>].agg(函数).fillna(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>上面两个函数完全等价，pivot_table仿佛是加入了columns与margin功能的groupby函数，比groupby更加灵活。</p>
<h2 id="query"><a href="#query" class="headerlink" title="query"></a>query</h2><p>当表格生成后如何查询某一项数据呢？</p>
<p>ex.根据上表查询哈登对阵灰熊时的数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table.query(<span class="string">'对手 == ["灰熊"]'</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic18.png" alt="pic18"></p>
<h2 id="Cheat-Sheet"><a href="#Cheat-Sheet" class="headerlink" title="Cheat Sheet"></a>Cheat Sheet</h2><p><img src="/2019/05/25/数据挖掘比赛入坑（三）/pic19.png" alt="pic19"></p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li><a href="https://zhuanlan.zhihu.com/p/31952948" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/31952948</a></li>
</ol>

      
    </div>
    
    
    

	<div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/数据挖掘/" rel="tag"># 数据挖掘</a>
          
            <a href="/tags/Kaggle比赛/" rel="tag"># Kaggle比赛</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/05/25/最大熵、逻辑回归的关系/" rel="next" title="最大熵、逻辑回归的关系">
                <i class="fa fa-chevron-left"></i> 最大熵、逻辑回归的关系
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/27/Spark（一）/" rel="prev" title="Spark（一）">
                Spark（一） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div id="gitalk-container"></div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/xuanyi.jpg" alt="Yif Du">
            
              <p class="site-author-name" itemprop="name">Yif Du</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">167</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">132</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yifdu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="17210240004@fudan.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#数据挖掘重要库——pandas"><span class="nav-number">1.</span> <span class="nav-text">数据挖掘重要库——pandas</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#groupby-聚合-分组级运算"><span class="nav-number">1.1.</span> <span class="nav-text">groupby,聚合,分组级运算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">1.1.1.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas-窗口函数"><span class="nav-number">1.2.</span> <span class="nav-text">pandas 窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rolling-函数"><span class="nav-number">1.2.1.</span> <span class="nav-text">.rolling()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#expanding-函数"><span class="nav-number">1.2.2.</span> <span class="nav-text">.expanding()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ewm-函数"><span class="nav-number">1.2.3.</span> <span class="nav-text">.ewm()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas缺失数据"><span class="nav-number">1.3.</span> <span class="nav-text">Pandas缺失数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#何时以及为什么数据丢失？"><span class="nav-number">1.3.1.</span> <span class="nav-text">何时以及为什么数据丢失？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检查缺失值"><span class="nav-number">1.3.2.</span> <span class="nav-text">检查缺失值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缺少数据的计算"><span class="nav-number">1.3.3.</span> <span class="nav-text">缺少数据的计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#清理-填充缺少数据"><span class="nav-number">1.3.4.</span> <span class="nav-text">清理/填充缺少数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用标量值替换NaN"><span class="nav-number">1.3.5.</span> <span class="nav-text">用标量值替换NaN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#填写NA前进和后退"><span class="nav-number">1.3.6.</span> <span class="nav-text">填写NA前进和后退</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#丢失缺少的值"><span class="nav-number">1.3.7.</span> <span class="nav-text">丢失缺少的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#替换丢失-或-通用值"><span class="nav-number">1.3.8.</span> <span class="nav-text">替换丢失(或)通用值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas合并-连接"><span class="nav-number">1.4.</span> <span class="nav-text">Pandas合并/连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在一个键上合并两个数据帧"><span class="nav-number">1.4.1.</span> <span class="nav-text">在一个键上合并两个数据帧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合并多个键上的两个数据框"><span class="nav-number">1.4.2.</span> <span class="nav-text">合并多个键上的两个数据框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合并使用“how”的参数"><span class="nav-number">1.4.3.</span> <span class="nav-text">合并使用“how”的参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas级联"><span class="nav-number">1.5.</span> <span class="nav-text">Pandas级联</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连接对象"><span class="nav-number">1.5.1.</span> <span class="nav-text">连接对象</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间序列"><span class="nav-number">1.6.</span> <span class="nav-text">时间序列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取当前时间"><span class="nav-number">1.6.1.</span> <span class="nav-text">获取当前时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个时间范围"><span class="nav-number">1.6.2.</span> <span class="nav-text">创建一个时间范围</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas时间差"><span class="nav-number">1.7.</span> <span class="nav-text">Pandas时间差</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串"><span class="nav-number">1.7.1.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整数"><span class="nav-number">1.7.2.</span> <span class="nav-text">整数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据偏移"><span class="nav-number">1.7.3.</span> <span class="nav-text">数据偏移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运算操作"><span class="nav-number">1.7.4.</span> <span class="nav-text">运算操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pandas-可视化"><span class="nav-number">1.8.</span> <span class="nav-text">Pandas 可视化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#条形图"><span class="nav-number">1.8.1.</span> <span class="nav-text">条形图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#直方图"><span class="nav-number">1.8.2.</span> <span class="nav-text">直方图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#箱形图"><span class="nav-number">1.8.3.</span> <span class="nav-text">箱形图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区域块图形"><span class="nav-number">1.9.</span> <span class="nav-text">区域块图形</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#散点图形"><span class="nav-number">1.9.1.</span> <span class="nav-text">散点图形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#饼状图"><span class="nav-number">1.9.2.</span> <span class="nav-text">饼状图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pandas的10大秘籍"><span class="nav-number">2.</span> <span class="nav-text">Pandas的10大秘籍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#read-cs"><span class="nav-number">2.1.</span> <span class="nav-text">read_cs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#select-dtypes"><span class="nav-number">2.2.</span> <span class="nav-text">select_dtypes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy"><span class="nav-number">2.3.</span> <span class="nav-text">copy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#map"><span class="nav-number">2.4.</span> <span class="nav-text">map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#是否需要-apply-自定义函数？"><span class="nav-number">2.5.</span> <span class="nav-text">是否需要 apply 自定义函数？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#value-counts"><span class="nav-number">2.6.</span> <span class="nav-text">value_counts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理数据与缺失值"><span class="nav-number">2.7.</span> <span class="nav-text">处理数据与缺失值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据ID选择特定的行"><span class="nav-number">2.8.</span> <span class="nav-text">根据ID选择特定的行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#按百分比进行数据分组"><span class="nav-number">2.9.</span> <span class="nav-text">按百分比进行数据分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#to-csv"><span class="nav-number">2.10.</span> <span class="nav-text">to_csv</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pandas透视表-pivot-Table"><span class="nav-number">3.</span> <span class="nav-text">pandas透视表(pivot Table)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要用pivot-table"><span class="nav-number">3.1.</span> <span class="nav-text">为什么要用pivot_table</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何使用pivot-table"><span class="nav-number">3.2.</span> <span class="nav-text">如何使用pivot_table</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Index"><span class="nav-number">3.3.</span> <span class="nav-text">Index</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Values"><span class="nav-number">3.4.</span> <span class="nav-text">Values</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Aggfunc"><span class="nav-number">3.5.</span> <span class="nav-text">Aggfunc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Columns"><span class="nav-number">3.6.</span> <span class="nav-text">Columns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pivot-table-vs-groupby"><span class="nav-number">3.7.</span> <span class="nav-text">pivot_table vs. groupby</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#query"><span class="nav-number">3.8.</span> <span class="nav-text">query</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cheat-Sheet"><span class="nav-number">3.9.</span> <span class="nav-text">Cheat Sheet</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考文献"><span class="nav-number">4.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
            

			
          </div>
        </section>
      <!--/noindex-->
      

      
	 

    </div>
		  
	  
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="heart">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yif Du</span>

  
</div>





        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="/js/src/md5.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: '7428ad62daef314bef06',
          clientSecret: '93cd3f4cd41cfc00c4760f65f8d895a66088ea5a',
          repo: 'Comments',
          owner: 'yifdu',
          admin: ['yifdu'],
          id: md5(location.pathname),
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>


  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  <style>
#selectionCopyright {
    position: absolute;
    display: none;
    background: rgba(244,67,54,.7);
    color: #fff;
    border-radius: 6px;
    box-shadow: none;
    border: none;
    font-size: 14px;
}
#selectionCopyright a{
    color:#fff;
    border-color: #fff;
}
#selectionCopyright::before {
    content: "";
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 6px 8px 6px 0;
    border-color: transparent rgba(244,67,54,.7) transparent transparent;
    position: absolute;
    left: -8px;
    top:50%;
    transform:translateY(-50%);
}
</style>

<button id="selectionCopyright" disabled="disabled">本文发表于[<a href="http://yifdu.github.io">yifdu.github.io</a>]分享请注明来源！</button>

<script>
window.onload = function() {
    function selectText() {
        if (document.selection) { //IE浏览器下
            return document.selection.createRange().text; //返回选中的文字
        } else { //非IE浏览器下
            return window.getSelection().toString(); //返回选中的文字
        }
    }
    var content = document.getElementsByTagName("body")[0];
    var scTip = document.getElementById('selectionCopyright');

    content.onmouseup = function(ev) { //设定一个onmouseup事件
        var ev = ev || window.event;
        var left = ev.clientX;//获取鼠标相对浏览器可视区域左上角水平距离距离
        var top = ev.clientY;//获取鼠标相对浏览器可视区域左上角垂直距离距离
        var xScroll = Math.max(document.body.scrollLeft, document.documentElement.scrollLeft);//获取文档水平滚动距离
        var yScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);//获取文档垂直滚动距离
        if (selectText().length > 0) {
            setTimeout(function() { //设定一个定时器
                scTip.style.display = 'inline-block';
                scTip.style.left = left + xScroll + 15 + 'px';//鼠标当前x值
                scTip.style.top = top + yScroll - 15 + 'px';//鼠标当前y值
            }, 100);
        } else {
            scTip.style.display = 'none';
        }
    };

    content.onclick = function(ev) {
        var ev = ev || window.event;
        ev.cancelBubble = true;
    };
    document.onclick = function() {
        scTip.style.display = 'none';
    };
};
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-miku"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
